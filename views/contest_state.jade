extends layout

block content
    script.
      $('#CONTESTS').addClass('active')
    .container
      if(contest === "acm")
        blockquote
          | 由于四六级口试需要使用机房<br>校内赛比赛时间改为5月27日，带来不便请您谅解<br>
          | 欢迎加入pku2018校赛玩家QQ群，群号码：631207317。Telegram群：https://t.me/joinchat/GaEGzk44-mX5WrGeZfbqVg<br>
          | <br>
          | 请注意评奖规则更改为：北大校内参赛队伍与校外参赛队伍<span class="blue-text">分开</span>参与评奖
        script.
          Materialize.toast('校内赛比赛时间改为5月27日', 5000, 'rounded')
        h2 ACM校内赛
      else if(contest === "jiying")
        blockquote
          | 网站试运行，遇到任何问题请与我们联系 <br>
        script.
          Materialize.toast('网站试运行，遇到任何问题请与我们联系', 5000, 'rounded')
        //  alert('网站试运行，遇到任何问题请与我们联系')
        h2
          | 计算机应用设计大赛
          h4
            | 比赛相关通知：<a href='/documents/info.zip' target="_blank">下载链接</a>
      .row
        .col.s4
          ul
            li.list1
              h3 赛事状态
              ul.collapsible.popout(data-collapsible="accordion")
                li
                  .collapsible-header.active
                    赛前组队
                  .collapsible-body
                    if(contest === "acm")
                      p
                        | 比赛允许1-3人组队，所有参赛人员应先注册并报名，然后选择加入一支队伍加入或者自己组建新的队伍，
                        | 请在右侧进行操作。报名后会自动分配到一个默认队伍，请自行更改队伍名字或者加入新的队伍。
                    else if(contest === "jiying")
                      p
                        | 比赛组队人员限制将尽快公布。
                        | 所有参赛人员应先注册并报名，然后选择加入一支队伍加入或者自己组建新的队伍，
                        | 请在右侧进行操作。<br>
                      h5
                        | 比赛相关通知：<a href='/documents/info.zip' target="_blank">下载链接</a>
                li
                  .collapsible-header
                    | 比赛时间
                  .collapsible-body
                    if(contest === "acm")
                      p
                        | ACM校内赛尚未开始。
                        | 比赛预计将在2018年5月20日举行，请关注比赛动态，不要错过比赛时间
                    else if(contest === "jiying")
                      p
                        | 计算机应用设计大赛分为校内初赛、市级复赛和全国总决赛。
                        | 初赛尚未开始。
                        | 初赛预计将在2018年4月择期举行，请关注比赛动态，不要错过比赛时间。
                li
                  .collapsible-header
                    | 比赛地点
                  .collapsible-body
                    if(contest === "acm")
                      p
                        | ACM校内赛尚未开始。
                        | 比赛预计将在北京大学计算机机房举行，请关注比赛动态，获悉比赛地点
                    else if(contest === "jiying")
                      p
                        | 计算机应用设计大赛分为校内初赛、市级复赛和全国总决赛。
                        | 初赛尚未开始。
                        | 初赛预计将在北京大学校内举行，地点尚未确定，请关注比赛动态，获悉比赛地点。

                li
                  .collapsible-header
                    if(contest === "acm")
                      | 比赛成绩及奖励
                    else if(contest === "jiying")
                      | 作品管理
                  .collapsible-body
                    if(contest === "acm")
                      p
                        | 比赛成绩将在本网站公布，请及时查询。<br>
                        | 竞赛设一等奖4队，二等奖30队，三等奖60队，优秀奖若干，北大校内参赛队伍与校外参赛队伍<span class="blue-text">分开</span>参与评奖，计入优秀奖总得奖率超过50%
                        | <br>
                        | 参加比赛可以获得程序设计实习和算法设计与分析课程的加分
                    else if(contest === "jiying")
                      p
                        | 参赛作品在初赛正式开始之前可以修改，比赛以最后一次上传作品作为有效参赛作品。
                        | 初赛结束后成功晋级到复赛的作品，本网站会在特定时间开放提交入口进行进一步修改。

                li
                  .collapsible-header
                    if(contest === "acm")
                      | 颁奖仪式
                    else if(contest === "jiying")
                      | 比赛成绩及奖励
                  .collapsible-body
                    if(contest === "acm")
                      p
                        | 颁奖仪式预计在2018年6月于北京大学校内举行，请持续关注信息。
                    else if(contest === "jiying")
                      p
                        | 比赛成绩将在本网站公布，请及时查询。
                        | 根据成绩奖励将有所不同，具体细节将在比赛前公布。
        if(sign)
          .col.s4
            ul
              li.list1
                h3.m_3 您的状态
                ul.collapsible.popout(data-collapsible="accordion")
                  li
                    .collapsible-header.active
                      报名
                    .collapsible-body
                      您已经报名成功。
                      您的id是：#{id}
                      <br> 您的组队key是：#{team_key}
                      if(contest === "jiying")
                        <br> 您报名的类别是：#{sign_tp}
                  li
                    .collapsible-header.active
                      组队情况
                    .collapsible-body
                      if(team_name < 0)
                        p
                          | 您还没有组队
                      else
                        p
                           您已经在一个队伍中了<br>
                           您所在的队伍名为：#{team_name}<br>
                           您所在的队伍id为：#{team_id}<br>
                           您所在的队伍的成员包括：<br>
                           #{member_info}
                  li
                    .collapsible-header.active
                      if(contest === "acm")
                        | 参赛情况
                      else if(contest === "jiying")
                        | 作品上交情况
                    .collapsible-body
                      if(contest === "acm")
                        if(attend_confirm > 0)
                          p
                            | 您已经参加了比赛。
                        else if(attend_confirm === 0)
                          p
                            | 比赛已经结束，您没有参加比赛，如果有问题，请向我们反映。
                        else if(attend_confirm < 0)
                          p
                            | 比赛尚未开始，请关注比赛时间不要错过。
                      else if(contest === "jiying")
                        if(other > 0)
                          p
                            | 您已经上传过作品（文件名是队伍id）：<strong> #{file_name} </strong>
                            | <br>
                            a.button.btn.waves-effect.waves-light(href="/downloads/contests?id=#{id}&file_name=#{file_name}")
                              下载之前上传的文件
                        else if(other < 0)
                          p
                            | 您尚未上传作品
                   li
                    .collapsible-header.active
                      if(contest === "acm")
                        | 比赛成绩
                      else if(contest === "jiying")
                        | 参赛情况
                    .collapsible-body
                      if(contest === "acm")
                        if(prize < 0)
                          p
                            | 成绩尚未公布
                        else if(prize === 1)
                          p
                            | 恭喜，您获得了一等奖。
                        else if(prize === 2)
                          p
                            | 恭喜，您获得了二等奖。
                        else if(prize === 3)
                          p
                            | 恭喜，您获得了三等奖。
                        else
                          p
                            | 很遗憾，您没有获得奖项。
                      else if(contest === "jiying")
                        if(attend_confirm > 0)
                          p
                            | 您已经参加了比赛。
                        else if(attend_confirm === 0)
                          p
                            | 比赛已经结束，您没有参加比赛，如果有问题，请向我们反映。
                        else if(attend_confirm < 0)
                          p
                            | 比赛尚未开始，请关注比赛时间不要错过。

                if(contest === "jiying")
                  li
                    .collapsible-header.active
                      | 比赛成绩
                    .collapsible-body
                        if(prize < 0)
                          p
                            | 成绩尚未公布
                        else if(prize === 1)
                          p
                            | 恭喜，您获得了一等奖。
                        else if(prize === 2)
                          p
                            | 恭喜，您获得了二等奖。
                        else if(prize === 3)
                          p
                            | 恭喜，您获得了三等奖。
                        else
                          p
                            | 很遗憾，您没有获得奖项。

          .col.s4
            ul
              li.list1
                h3 报名已经截止，遇到任何问题请与我们联系
                //- h3 更改队伍信息
            //- form(action="/contests/change_team_name", method="get")
                  input(type="hidden" name="id" value="#{id}")
                  input(type="hidden" name="contest" value="#{contest}")
                  input.validate(type="text" name="new_team" required placeholder="新的队伍名称" data-error="新的队伍名称" data-success="right")
                  input.button.btn.waves-effect.waves-light(type="submit" value="我要更改队伍名")
            //- h5 注意：要和对方组队，需要填入对方的组队key
            //- form(action="/contests/add_member", method="get")
                  input(type="hidden" name="id" value="#{id}")
                  input(type="hidden" name="contest" value="#{contest}")
                  input.validate(type="text" name="number" required placeholder="要加入的队员id" data-error="要加入的队员id" data-success="right")
                  input.validate(type="text" name="key" required placeholder="该队员组队key" data-error="该队员组队key" data-success="right")
                  input.button.btn.waves-effect.waves-light(type="submit" value="我要加入一个队员")
            if(contest==="jiying")
              ul.topic_grid
                li.list1
                  h3.m_3 上传作品
                form(action="/contests/upload/?id=#{id}&contest=#{contest}" method="post" enctype="multipart/form-data")
                  .file-field.input-field
                    .btn
                      span
                        | File
                      input(required type="file" name="file")
                    .file-path-wrapper
                      input.file-path.validate(type="text")
                    input.button.btn.waves-effect.waves-light.rotate2(type="submit" value="提交")
                p#fileName
                script.
                  $("#file").on("change", function () {
                      //截取路径，获取上传文件名
                      var urlArr = this.value.split("\\");
                      if (this && this.files && this.files[0]) {
                          document.getElementById("fileName").innerHTML = urlArr[urlArr.length - 1];
                          var fileUrl = URL.createObjectURL(this.files[0]);
                          //document.getElementById("fileImg").src = fileUrl;
                      } else {
                          //兼容IE9以下
                          document.getElementById("fileName").innerHTML = urlArr[urlArr.length - 1];
                          //document.getElementById("fileImg").style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                          //document.getElementById("fileImg").filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = this.value;
                      }
                  });

            a.right.button.btn.waves-effect.waves-light(href='/contests/?id=#{id}')
                | 返回
                span
        else
          .col.s8
            if(contest === "jiying")
              nav.nav-extended
                .nav-content
                  ul.tabs.tabs-transparent
                    li.tab
                      a.active(href='#type1') 软件应用与开发
                    li.tab
                      a(href='#type2') 数字媒体设计
                    li.tab
                      a(href='#type3') 人工智能类

              a#type1.col.btn.waves-effect.waves-light(href='/contests/sign/?id=#{id}&contest=#{contest}&type=1') 软件应用与开发
                | 报名
              a#type2.col.btn.waves-effect.waves-light(href='/contests/sign/?id=#{id}&contest=#{contest}&type=2') 数字媒体设计
                | 报名
              a#type3.col.btn.waves-effect.waves-light(href='/contests/sign/?id=#{id}&contest=#{contest}&type=3') 人工智能类
                | 报名
            else
              h5 报名已经截止
              //- a.button.btn.waves-effect.waves-light(href='/contests/sign/?id=#{id}&contest=#{contest}&type=0')
                | 点击报名
              h5 赞助商：
              img.responsive-img(src='/images/赞助商.jpg')
